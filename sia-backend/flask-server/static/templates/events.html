{% extends "base.html" %}

{% block title %}
   Events
{% endblock %}

{% block content %}

<style>
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    table, th, td {
        border: 2px solid #000000;
    }
    th, td {
        padding: 10px;
        text-align: left;
    }
</style>
{% if events %}
<div class="container" data-bs-theme="dark" style="margin: 100px auto 50px auto ;">
    <div class="row row-cols-1 row-cols-md-4 g-4 " style="justify-content: center;">
            {% for event in events %}
                <div class="col">
                    <div class="card h-100" style="box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
                        <img src="{{ url_for('static', filename='images/eventposter/' + event.uid|string ) }}" class="card-img-top" alt="...">
                        <div class="card-body">
                            <h5 class="card-title">{{ event.name }}</h5>
                            <p class="card-text">{{ event.description }}</p>
                        </div>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">{{ event.place }}</li>
                            <li class="list-group-item">{{ event.date }}-{{ event.end }}</li>
                        </ul>
                        {% if current_user.is_authenticated and hasPermissions("events.help") or current_user.is_authenticated and events.registrationManager %}
                        <div class="card-foot" style="margin: 5px; align-items: center; display: flex; flex-wrap: wrap;">
                        {% endif%}

                        {% if current_user.is_authenticated and hasPermissions("events.help") %}
                            <div style="align-items: center; display: flex; min-width: 100%; margin: 5px;">
                                &nbsp;{{ event.individuals_count}}&nbsp;
                                <!-- SVG Person -->
                                <svg fill="#FFF" width="20px" height="20px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 15.503A5.041 5.041 0 1 0 16 5.42a5.041 5.041 0 0 0 0 10.083zm0 2.215c-6.703 0-11 3.699-11 5.5v3.363h22v-3.363c0-2.178-4.068-5.5-11-5.5z"/></svg>
                                
                                &nbsp;{{ event.duty_count}}|{{ event.shift_count}}&nbsp;
                                <!--SVG Tasche-->
                                    <svg width="20px" height="20px" viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <title>work-case-filled</title>
                                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                            <g id="work-case" fill="#FFF" transform="translate(42.666667, 64.000000)">
                                                <path d="M1.20792265e-13,197.76 C54.5835501,218.995667 112.186031,231.452204 170.666667,234.666667 L170.666667,277.333333 L256,277.333333 L256,234.666667 C314.339546,231.013 371.833936,218.86731 426.666667,198.613333 L426.666667,362.666667 L1.20792265e-13,362.666667 L1.20792265e-13,197.76 Z M277.333333,-1.42108547e-14 L298.666667,21.3333333 L298.666667,64 L426.666667,64 L426.666667,175.146667 C361.254942,199.569074 292.110481,212.488551 222.293333,213.333333 L222.293333,213.333333 L206.933333,213.333333 C136.179047,212.568604 66.119345,199.278929 7.10542736e-15,174.08 L7.10542736e-15,174.08 L7.10542736e-15,64 L128,64 L128,21.3333333 L149.333333,-1.42108547e-14 L277.333333,-1.42108547e-14 Z M256,42.6666667 L170.666667,42.6666667 L170.666667,64 L256,64 L256,42.6666667 Z" id="Combined-Shape-Copy">
                                    
                                    </path>
                                            </g>
                                        </g>
                                    </svg>
                                &nbsp;0|0&nbsp;   
                                <!--SVG TASK-->
                                <svg width="20px" height="20px" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                                    <path fill="#FFF" fill-rule="evenodd" d="M4,4 L9,4 C9.55228,4 10,3.55228 10,3 C10,2.44772 9.55228,2 9,2 L4,2 C2.89543,2 2,2.89543 2,4 L2,12 C2,13.1046 2.89543,14 4,14 L12,14 C13.1046,14 14,13.1046 14,12 L14,10 C14,9.44771 13.5523,9 13,9 C12.4477,9 12,9.44771 12,10 L12,12 L4,12 L4,4 Z M15.2071,2.29289 C14.8166,1.90237 14.1834,1.90237 13.7929,2.29289 L8.5,7.58579 L7.70711,6.79289 C7.31658,6.40237 6.68342,6.40237 6.29289,6.79289 C5.90237,7.18342 5.90237,7.81658 6.29289,8.20711 L7.79289,9.70711 C7.98043,9.89464 8.23478,10 8.5,10 C8.76522,10 9.01957,9.89464 9.20711,9.70711 L15.2071,3.70711 C15.5976,3.31658 15.5976,2.68342 15.2071,2.29289 Z"/>
                                </svg>
                                {% if event.visibility == "private" %} 
                                    &nbsp;
                                    <svg
                                        width="25px"
                                        height="25px"
                                        viewBox="0 0 143.13806 147.02239"
                                        version="1.1"
                                        id="svg5"
                                        inkscape:version="1.2.1 (9c6d41e410, 2022-07-14)"
                                        sodipodi:docname="pSchloss1.svg"
                                        xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                                        xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                                        xmlns="http://www.w3.org/2000/svg"
                                        xmlns:svg="http://www.w3.org/2000/svg">
                                        <sodipodi:namedview
                                            id="namedview7"
                                            pagecolor="#ffffff"
                                            bordercolor="#000000"
                                            borderopacity="0.25"
                                            inkscape:showpageshadow="2"
                                            inkscape:pageopacity="0.0"
                                            inkscape:pagecheckerboard="0"
                                            inkscape:deskcolor="#d1d1d1"
                                            inkscape:document-units="mm"
                                            showgrid="false"
                                            inkscape:zoom="0.71624579"
                                            inkscape:cx="539.61923"
                                            inkscape:cy="344.1556"
                                            inkscape:window-width="1920"
                                            inkscape:window-height="991"
                                            inkscape:window-x="-9"
                                            inkscape:window-y="-9"
                                            inkscape:window-maximized="1"
                                            inkscape:current-layer="layer1" />
                                        <defs
                                            id="defs2" />
                                        <g
                                            inkscape:label="Ebene 1"
                                            inkscape:groupmode="layer"
                                            id="layer1"
                                            transform="translate(-32.13806,-88.656716)">
                                            <path
                                                id="path1002"
                                                style="fill:#ffffff;stroke:#000000;stroke-width:2.065;stroke-opacity:1;stroke-dasharray:none"
                                                d="m 60.212632,142.91304 v 84.2238 h 84.223798 v -84.2238 z m 27.048995,19.08411 h 12.495877 c 0.345386,0 0.684296,0.004 1.016476,0.0114 0.33218,0.007 0.65771,0.0182 0.97668,0.0331 0.31897,0.0148 0.63113,0.0336 0.93689,0.0558 0.30576,0.0222 0.60507,0.0479 0.89762,0.0775 0.29255,0.0296 0.57849,0.0632 0.85783,0.10025 0.27934,0.037 0.55191,0.0775 0.81804,0.12196 0.26613,0.0445 0.52584,0.0928 0.77876,0.14469 0.25293,0.0519 0.49927,0.10763 0.73898,0.16692 0.23971,0.0567 0.47605,0.11733 0.709,0.18241 0.23294,0.0651 0.46215,0.13428 0.68833,0.20774 0.22618,0.0735 0.44928,0.15123 0.66869,0.23306 0.21941,0.0818 0.43538,0.16817 0.64802,0.25839 0.21265,0.0902 0.42199,0.18459 0.62787,0.28318 0.20588,0.0986 0.40809,0.20103 0.6072,0.30799 0.19912,0.10697 0.39521,0.21849 0.58756,0.33383 0.19235,0.11535 0.38131,0.23492 0.56689,0.35864 0.21909,0.14692 0.43168,0.29829 0.63821,0.45423 0.20652,0.15594 0.40652,0.31615 0.60048,0.48111 0.19396,0.16496 0.38188,0.33451 0.56327,0.5085 0.18139,0.17398 0.35672,0.35236 0.52555,0.53537 0.16883,0.183 0.33104,0.37073 0.48731,0.56275 0.15626,0.19203 0.3064,0.38858 0.4501,0.58963 0.1437,0.20105 0.28125,0.40643 0.41238,0.6165 0.13113,0.21007 0.25557,0.4248 0.37413,0.64389 0.0606,0.10954 0.11943,0.22066 0.17622,0.33383 0.0568,0.11317 0.11185,0.2284 0.16485,0.34519 0.053,0.1168 0.10375,0.23512 0.15296,0.35554 0.0492,0.12042 0.0967,0.24286 0.14211,0.3669 0.0454,0.12405 0.0891,0.25009 0.13074,0.37776 0.0417,0.12766 0.0815,0.25679 0.11938,0.38809 0.0378,0.13129 0.0734,0.26454 0.10748,0.39946 0.0341,0.13491 0.0663,0.27176 0.0966,0.41031 0.0606,0.27708 0.11373,0.56107 0.15916,0.85266 0.0454,0.29158 0.0834,0.5905 0.11369,0.89658 0.0303,0.30609 0.0531,0.61942 0.0682,0.94 0.0151,0.32058 0.0227,0.64832 0.0227,0.9834 0,0.25518 -0.006,0.50846 -0.017,0.75913 -0.0113,0.25066 -0.0281,0.49902 -0.0507,0.74517 -0.0225,0.24616 -0.0509,0.4901 -0.0847,0.73174 -0.0338,0.24164 -0.0732,0.48065 -0.11834,0.71778 -0.0451,0.23714 -0.0961,0.47225 -0.15244,0.70487 -0.0564,0.23262 -0.11838,0.4628 -0.18604,0.69092 -0.0677,0.22811 -0.14068,0.45439 -0.21962,0.67799 -0.0789,0.2236 -0.16352,0.44495 -0.25373,0.66404 -0.0876,0.21651 -0.17981,0.4293 -0.27647,0.63872 -0.0967,0.20943 -0.19818,0.4152 -0.30386,0.61754 -0.10568,0.20233 -0.21551,0.40109 -0.33021,0.59634 -0.1147,0.19525 -0.23388,0.387 -0.3576,0.57516 -0.12372,0.18816 -0.25225,0.3729 -0.38499,0.55397 -0.13274,0.18107 -0.2701,0.35829 -0.41186,0.53227 -0.14177,0.17398 -0.28795,0.3447 -0.43874,0.5116 -0.15078,0.16689 -0.30579,0.33008 -0.4656,0.48989 -0.19847,0.19847 -0.40177,0.391 -0.60926,0.57722 -0.2075,0.18623 -0.41911,0.36604 -0.63562,0.54002 -0.21652,0.17399 -0.438,0.34211 -0.66353,0.50385 -0.22553,0.16174 -0.45533,0.31714 -0.68988,0.46664 -0.23456,0.14949 -0.47369,0.29321 -0.71727,0.43046 -0.24358,0.13725 -0.49154,0.26825 -0.74414,0.39326 -0.2526,0.12501 -0.50991,0.2438 -0.77153,0.35657 -0.26162,0.11276 -0.52776,0.21935 -0.7984,0.31987 -0.27064,0.0979 -0.54983,0.18974 -0.83819,0.27544 -0.28836,0.0857 -0.58586,0.16528 -0.89194,0.23874 -0.30608,0.0735 -0.62084,0.14084 -0.94464,0.20206 -0.3238,0.0612 -0.65635,0.11639 -0.99787,0.16536 -0.34153,0.049 -0.69186,0.0919 -1.0511,0.12868 -0.35925,0.0367 -0.72736,0.0675 -1.10433,0.092 -0.37696,0.0245 -0.76287,0.0425 -1.15755,0.0548 -0.39469,0.0122 -0.798366,0.0186 -1.210776,0.0186 h -6.12417 v 17.1664 H 87.261587 Z M 102.3245,93.828381 A 33.615673,57.626865 0 0 0 69.094491,142.91324 h 7.364925 a 26.169173,48.486618 0 0 1 25.866634,-41.27397 26.169173,48.486618 0 0 1 25.87646,41.27397 h 7.36493 A 33.615673,57.626865 0 0 0 102.3245,93.828381 Z m -8.938696,73.426849 v 18.40352 h 5.16506 c 0.3093,0 0.6116,-0.003 0.9064,-0.01 0.29481,-0.007 0.582166,-0.017 0.862476,-0.0305 0.28031,-0.0135 0.55378,-0.0303 0.81959,-0.0506 0.26581,-0.0203 0.52435,-0.0443 0.77566,-0.0713 0.25131,-0.0271 0.49493,-0.0576 0.73174,-0.0915 0.23681,-0.0338 0.46653,-0.071 0.68885,-0.11162 0.22231,-0.0406 0.43762,-0.0844 0.64544,-0.13177 0.20781,-0.0474 0.40819,-0.0983 0.60151,-0.15245 0.19331,-0.0567 0.38208,-0.11714 0.56637,-0.1819 0.1843,-0.0648 0.36423,-0.13337 0.53951,-0.20619 0.17527,-0.0728 0.34586,-0.15012 0.51211,-0.23099 0.16625,-0.0809 0.32801,-0.16533 0.48524,-0.25425 0.15723,-0.0889 0.31016,-0.18207 0.45837,-0.27905 0.14821,-0.097 0.29179,-0.19779 0.43098,-0.30283 0.13919,-0.10503 0.27395,-0.21454 0.40411,-0.32763 0.13017,-0.11308 0.25558,-0.22973 0.37672,-0.35088 0.12115,-0.12372 0.23773,-0.24829 0.34985,-0.37362 0.11212,-0.12533 0.21988,-0.25184 0.32298,-0.37879 0.1031,-0.12694 0.20151,-0.25436 0.29559,-0.38292 0.0941,-0.12855 0.18366,-0.25792 0.26872,-0.38809 0.085,-0.13016 0.1658,-0.26148 0.24184,-0.39326 0.076,-0.13177 0.14744,-0.264 0.21446,-0.39739 0.067,-0.13339 0.12959,-0.26756 0.18758,-0.40256 0.058,-0.135 0.11175,-0.27112 0.16072,-0.40773 0.0516,-0.1366 0.0996,-0.27519 0.14469,-0.41599 0.0451,-0.1408 0.0869,-0.28341 0.12558,-0.4284 0.0387,-0.14498 0.0742,-0.29214 0.10645,-0.44131 0.0322,-0.14918 0.061,-0.30036 0.0868,-0.45372 0.0258,-0.15337 0.0484,-0.30909 0.0677,-0.46664 0.0193,-0.15755 0.0357,-0.3173 0.0486,-0.47904 0.0129,-0.16174 0.0225,-0.32552 0.0289,-0.49145 0.006,-0.16592 0.01,-0.33372 0.01,-0.50384 0,-0.19847 -0.005,-0.39399 -0.0134,-0.58601 -0.009,-0.19203 -0.0214,-0.38079 -0.0388,-0.56638 -0.0174,-0.18558 -0.0395,-0.36811 -0.0656,-0.54725 -0.0261,-0.17914 -0.0562,-0.35492 -0.091,-0.52762 -0.0348,-0.17269 -0.0743,-0.34224 -0.11782,-0.50849 -0.0435,-0.16625 -0.091,-0.32905 -0.14314,-0.48886 -0.0522,-0.15981 -0.10912,-0.31638 -0.17002,-0.46974 -0.0609,-0.15336 -0.12574,-0.3037 -0.19534,-0.45062 -0.0696,-0.14692 -0.14411,-0.29031 -0.22272,-0.43046 -0.0786,-0.14016 -0.16145,-0.27693 -0.24908,-0.41031 -0.0876,-0.13339 -0.17981,-0.26354 -0.27647,-0.39016 -0.0967,-0.12662 -0.19766,-0.24963 -0.30334,-0.36949 -0.10568,-0.11985 -0.21603,-0.23624 -0.33073,-0.34933 -0.1147,-0.11309 -0.23388,-0.22285 -0.3576,-0.32918 -0.12372,-0.10632 -0.25225,-0.20946 -0.38499,-0.30902 -0.13274,-0.0996 -0.26958,-0.19556 -0.41135,-0.28836 -0.12372,-0.0799 -0.25003,-0.15689 -0.37827,-0.23099 -0.12823,-0.0741 -0.25844,-0.14564 -0.39119,-0.21394 -0.13274,-0.0683 -0.26789,-0.13335 -0.40514,-0.19585 -0.13725,-0.0625 -0.27682,-0.1221 -0.41858,-0.1788 -0.14176,-0.0567 -0.28574,-0.11085 -0.43201,-0.16175 -0.14628,-0.0509 -0.29467,-0.0986 -0.44546,-0.14366 -0.15078,-0.0451 -0.3041,-0.0873 -0.4594,-0.12661 -0.1553,-0.0393 -0.31251,-0.0761 -0.47232,-0.10955 -0.15723,-0.0361 -0.31997,-0.0697 -0.48783,-0.10129 -0.16786,-0.0316 -0.34085,-0.0608 -0.51935,-0.0878 -0.17849,-0.0271 -0.36226,-0.0519 -0.55138,-0.0744 -0.18913,-0.0226 -0.38367,-0.0429 -0.58343,-0.061 -0.19976,-0.018 -0.40507,-0.034 -0.61547,-0.0475 -0.21039,-0.0135 -0.42596,-0.0246 -0.64698,-0.0336 -0.22103,-0.009 -0.44738,-0.0162 -0.67903,-0.0207 -0.231656,-0.005 -0.468776,-0.007 -0.711066,-0.007 z" />
                                        </g>
                                    </svg>
                                {% elif event.visibility == "member" %} 
                                    <svg
                                        width="25px"
                                        height="25px"
                                        viewBox="0 0 143.13806 147.02239"
                                        version="1.1"
                                        id="svg5"
                                        inkscape:version="1.2.1 (9c6d41e410, 2022-07-14)"
                                        sodipodi:docname="SchlossM.svg"
                                        xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
                                        xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
                                        xmlns="http://www.w3.org/2000/svg"
                                        xmlns:svg="http://www.w3.org/2000/svg">
                                        <sodipodi:namedview
                                        id="namedview7"
                                        pagecolor="#ffffff"
                                        bordercolor="#000000"
                                        borderopacity="0.25"
                                        inkscape:showpageshadow="2"
                                        inkscape:pageopacity="0.0"
                                        inkscape:pagecheckerboard="0"
                                        inkscape:deskcolor="#d1d1d1"
                                        inkscape:document-units="mm"
                                        showgrid="false"
                                        inkscape:zoom="0.71624579"
                                        inkscape:cx="539.61923"
                                        inkscape:cy="344.1556"
                                        inkscape:window-width="1920"
                                        inkscape:window-height="991"
                                        inkscape:window-x="-9"
                                        inkscape:window-y="-9"
                                        inkscape:window-maximized="1"
                                        inkscape:current-layer="layer1" />
                                        <defs
                                            id="defs2">
                                            <rect
                                                x="-89.354801"
                                                y="287.61077"
                                                width="19.546359"
                                                height="16.75402"
                                                id="rect5904" />
                                        </defs>
                                        <g
                                            inkscape:label="Ebene 1"
                                            inkscape:groupmode="layer"
                                            id="layer1"
                                            transform="translate(-32.13806,-88.656716)">
                                            <path
                                                id="path1002"
                                                style="fill:#ffffff;stroke:#000000;stroke-width:2.065;stroke-dasharray:none;stroke-opacity:1"
                                                d="M 103.07533 93.828493 A 33.615673 57.626865 0 0 0 69.845319 142.91284 L 60.963691 142.91284 L 60.963691 227.13664 L 145.18749 227.13664 L 145.18749 142.91284 L 136.31826 142.91284 A 33.615673 57.626865 0 0 0 103.07533 93.828493 z M 103.07688 101.63939 L 103.0774 101.63939 A 26.169173 48.486618 0 0 1 128.95386 142.91284 L 77.210244 142.91284 A 26.169173 48.486618 0 0 1 103.07688 101.63939 z M 80.75163 160.69986 L 89.843065 160.69986 L 103.21021 187.2817 L 116.14017 160.69986 L 125.40007 160.69986 L 125.40007 208.44475 L 118.73277 208.44475 L 118.73277 167.30515 L 104.79306 195.29775 L 100.81966 195.29775 L 86.980707 167.30515 L 86.980707 208.44475 L 80.75163 208.44475 L 80.75163 160.69986 z " />
                                        </g>
                                    </svg>
                            {% endif %}
                            {% if current_user.is_authenticated and hasPermissions("events.help") or current_user.is_authenticated and events.registrationManager %}
                            </div>
                            {% endif%}
                            {% if current_user.is_authenticated and hasPermissions("events.help") %}
                                {% if event.personal_count %}
                                    <button style="margin:2px;" type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#JoinShiftModal" data-id="{{ event.id }}" data-id="event.name">
                                        Helfen
                                    </button>
                                {% else %}
                                    <button style="margin:2px;" type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#JoinShiftModal" data-id="{{ event.id }}" data-id="event.name">
                                        Helfen
                                    </button>
                                {% endif%}
                            {% endif%}
    
                            {% if current_user.is_authenticated and event.registrationManager %}
                                <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#RegisterModal" data-id="{{ event.id }}" data-id="event.name"> 
                                    Anmelden
                                </button>
                            {% endif%}
                        </div>
                        {% endif %}
                    </div>

                </div>
            {%endfor%} 
        
    </div>
</div>
{% else %}
    <h3>Gerade gibt es keine Events.</h3>
    {% include 'beer.html' %}
{% endif %}

{% if current_user.is_authenticated and hasPermissions("events.help") %}
    <div class="modal fade" id="JoinShiftModal" tabindex="-1" aria-labelledby="JoinShiftModal" aria-hidden="true" data-bs-theme="dark" style="color:white;">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="JoinShiftModalLabel">Bei Event helfen</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <input id="id-shift-modal-form-event-id" type="hidden" value="">
                <table >
                <tbody id="id-shift-modal-table">
                    <tr>
                    <th>Typ</th>
                    <th>Start</th>
                    <th>Ende</th>
                    <th>Eingetragene Helfer</th>
                    </tr>
                </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fertig</button>
            </div>
            </div>
        </div>
    </div> 
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const CSRF = document.getElementById("CSRF").getAttribute("content");
            const ShiftModal = document.getElementById("JoinShiftModal");
            const idInput = document.getElementById("id-shift-modal-form-event-id");
        
            async function fetchShifts(eventId) {
                const tableBody = document.getElementById("id-shift-modal-table");
        
                try {
                    const response = await fetch(`/api/events/event/${eventId}/getshifts`, {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                        },
                    });
        
                    const data = await response.json();
                    tableBody.innerHTML = `
                        <tr>
                            <th>Typ</th>
                            <th>Start</th>
                            <th>Ende</th>
                            <th>Eingetragene Nutzer</th>
                            <th></th>
                        </tr>
                    `;
        
                    if (data.error) {
                        console.error(data.error);
                        return;
                    }
        
                    if (data.length === 0) {
                        const row = document.createElement("tr");
                        row.innerHTML = `<td colspan="5" class="text-center">Das Event besitzt keine Schichten bis jetzt</td>`;
                        tableBody.appendChild(row);
                    } else {
                        data.forEach((item) => {
                            const row = document.createElement("tr");
                            const usernames = item.users.length ? item.users.join(", ") : "-";
                            row.innerHTML = `
                                <td>${item.type}</td>
                                <td>${item.start ?? "-"}</td>
                                <td>${item.end ?? "-"}</td>
                                <td>${usernames ?? "-"}</td>
                                <td>
                                    <button class="join-btn btn btn-success" data-id="${item.id}" data-event-id="${eventId}"><svg width="20px" height="20px" viewBox="0 0 24 24" id="_24x24_On_Light_Session-Join" data-name="24x24/On Light/Session-Join" xmlns="http://www.w3.org/2000/svg"><rect id="view-box" width="24" height="24" fill="none"/><path id="Shape" d="M5.75,17.5a.75.75,0,0,1,0-1.5h8.8A1.363,1.363,0,0,0,16,14.75v-12A1.363,1.363,0,0,0,14.55,1.5H5.75a.75.75,0,0,1,0-1.5h8.8A2.853,2.853,0,0,1,17.5,2.75v12A2.853,2.853,0,0,1,14.55,17.5ZM7.22,13.28a.75.75,0,0,1,0-1.061L9.939,9.5H.75A.75.75,0,0,1,.75,8H9.94L7.22,5.28A.75.75,0,0,1,8.28,4.22l4,4,.013.013.005.006.007.008.007.008,0,.005.008.009,0,0,.008.01,0,0,.008.011,0,0,.008.011,0,0,.008.011,0,0,.007.011,0,.005.006.01,0,.007,0,.008,0,.009,0,.006.006.011,0,0,.008.015h0a.751.751,0,0,1-.157.878L8.28,13.28a.75.75,0,0,1-1.06,0Z" transform="translate(3.25 3.25)" fill="#FFF"/></svg></button>
                                    <button class="leave-btn btn btn-danger" data-id="${item.id}" data-event-id="${eventId}"><svg width="20px" height="20px" viewBox="0 0 24 24" id="_24x24_On_Light_Session-Leave" data-name="24x24/On Light/Session-Leave" xmlns="http://www.w3.org/2000/svg"><rect id="view-box" width="24" height="24" fill="none"/><path id="Shape" d="M2.95,17.5A2.853,2.853,0,0,1,0,14.75v-12A2.854,2.854,0,0,1,2.95,0h8.8a.75.75,0,0,1,0,1.5H2.95A1.362,1.362,0,0,0,1.5,2.75v12A1.363,1.363,0,0,0,2.95,16h8.8a.75.75,0,0,1,0,1.5Zm9.269-4.219a.751.751,0,0,1,0-1.061L14.939,9.5H5.75a.75.75,0,0,1,0-1.5h9.19L12.219,5.28A.75.75,0,1,1,13.28,4.22l4,4a.749.749,0,0,1,0,1.06l-4,4a.751.751,0,0,1-1.061,0Z" transform="translate(3.25 3.25)" fill="#FFF"/></svg></button>
                                </td>
                            `;
                            tableBody.appendChild(row);
                        });
        
                        document.querySelectorAll(".join-btn").forEach((button) => {
                            button.addEventListener("click", async function () {
                                const shiftId = this.getAttribute("data-id");
                                const eventId = this.getAttribute("data-event-id");
                                await joinShift(shiftId, this.closest("tr"), eventId);
                            });
                        });
                        document.querySelectorAll(".leave-btn").forEach((button) => {
                            button.addEventListener("click", async function () {
                                const shiftId = this.getAttribute("data-id");
                                const eventId = this.getAttribute("data-event-id");
                                await leaveShift(shiftId, this.closest("tr"), eventId);
                            });
                        });
                    }
                } catch (error) {
                    console.error("Fetch error:", error);
                }
            }
        
            async function joinShift(shiftId, rowElement, eventId) {
                try {
                    const response = await fetch(`/api/events/event/joinshift/${shiftId}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-CSRF-Token": CSRF,
                        },
                    });
        
                    if (!response.ok) {
                        throw new Error("Failed to join shift");
                    }
        
                    const data = await response.json();
                    console.log("Shift Joined:", data);
                    rowElement.remove(); 
        
                    await fetchShifts(eventId); 
                } catch (error) {
                    console.error("Join error:", error);
                }
            }
            async function leaveShift(shiftId, rowElement, eventId) {
                try {
                    const response = await fetch(`/api/events/event/leaveshift/${shiftId}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-CSRF-Token": CSRF,
                        },
                    });
        
                    if (!response.ok) {
                        throw new Error("Failed to leave shift");
                    }
        
                    const data = await response.json();
                    console.log("Shift left:", data);
                    rowElement.remove(); 
        
                    await fetchShifts(eventId); 
                } catch (error) {
                    console.error("left error:", error);
                }
            }
        
            
        
            ShiftModal.addEventListener("show.bs.modal", (event) => {
                const button = event.relatedTarget;
                const eventId = button.getAttribute("data-id");
                idInput.value = eventId;
        
                fetchShifts(eventId);
            });
        });
    </script> 
{% endif %}
{% endblock %}

