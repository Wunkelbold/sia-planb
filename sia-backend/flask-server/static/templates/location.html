{% extends "base.html" %}

    {% block additionalstyle %}
    {% endblock %}

    {% block additionaljavascript %}
    <script src="{{ url_for('static', filename='js/aframe.min.js') }}"></script>
      <script src="{{ url_for('static', filename='js/aframe-teleport-controls.min.js') }}"></script>
      <script type="module" src="{{ url_for('static', filename='js/drone-controls-mode2.js') }}"></script>
      <script type="module" src="{{ url_for('static', filename='js/mc-controls.js') }}"></script>
    {% endblock %}

    {% block content %}

<section class="white_224">
  <div style="  display: flex; margin: 20px; justify-content: center; align-items: center;flex-direction: column;">
    <h1 style="text-shadow: 0px 0px 3px rgb(102, 102, 102); text-align: center;" >Plan B &#128205;</h1>
    <h1 style="text-shadow: 0px 0px 3px rgb(102, 102, 102); text-align: center;" >Der Dreh- und Angelpunkt des Vereins</h1>
  </div>
  <div style="  display: flex; margin: 20px; justify-content: center; align-items: center;"><a href="{{url_for('contact')}}" class="btn btn-secondary btn-lg active" role="button" aria-pressed="true">Location mieten</a></div>
  <div class="glbcontainer">
      <div id="overlay">
          <button id="loadModelBtn" class="btn btn-secondary btn-lg active">3D Ansicht</button>
          <div id="loadingIndicator" class="">Navigation:<br>W A S D + Maus</div>
      </div>
      
      <a-scene id="scene" background="color: rgba(83,83,83,.5)" 
          renderer="colorManagement: true"     
          vr-mode-ui="enabled: true" 
          device-orientation-permission-ui="enabled: true"
          renderer="antialias: true">

          <a-assets xtimeout="10000" id="assets">
              <a-asset-item id="base" src="{{ url_for('static', filename='assets/Plan_B_3D_Scan.glb') }}"></a-asset-item>
          </a-assets>
      
          <a-entity light="type: ambient; color: #FFF"></a-entity>
      
          <a-entity id="cameraRig" position="0 0 0">
              <a-entity id="head" camera position="0 1.7 0" mc-controls look-controls></a-entity>
              <a-entity id="leftHand" hand-tracking-controls="hand: left;"></a-entity>
              <a-entity id="rightHand" hand-tracking-controls="hand: right;"></a-entity>
              <a-entity id="camera" camera wasd-controls look-controls position="0 0 0"></a-entity>
          </a-entity>
      </a-scene>
  </div>
  
  <!-- Gallery -->
  <div class="row " style="max-width: 1920px; margin: 20px;">
    <div class="col-lg-4 col-md-12 mb-4 mb-lg-0">
      <img
      src="/static/images/location/lernraum.jpg"
        class="w-100 shadow-1-strong rounded mb-4"
        alt=""
      />
      <img
      src="/static/images/location/eingang.jpg"
        class="w-100 shadow-1-strong rounded mb-4"
        alt=""
      />
      <img
      src="/static/images/location/bild31.jpg"
        class="w-100 shadow-1-strong rounded mb-4"
        alt=""
      />
    </div>
    <div class="col-lg-4 mb-4 mb-lg-0">
      <img
        src="/static/images/location/kinoabend.jpg"
        class="w-100 shadow-1-strong rounded mb-4"
        alt=""
      />
      <img
      src="/static/images/location/barbereich.jpg"
      class="w-100 shadow-1-strong rounded mb-4"
      alt=""
    />
    <img
    src="/static/images/location/liveband.jpg"
    class="w-100 shadow-1-strong rounded mb-4"
    alt=""
    />
    </div>
  
    <div class="col-lg-4 mb-4 mb-lg-0">

      <img
      src="/static/images/location/blacklight.jpg"
      class="w-100 shadow-1-strong rounded mb-4"
      alt=""
    />
  
      <img
      src="/static/images/location/terasse.jpg"
        class="w-100 shadow-1-strong rounded mb-4"
        alt=""
      />

      <img
      src="/static/images/location/stpatrick.jpg"
        class="w-100 shadow-1-strong rounded mb-4"
        alt=""
      />
    </div>
  </div>
</section>

<script type="module">
  document.getElementById("loadModelBtn").addEventListener("click", async () => {
    const overlay = document.getElementById("overlay");
    const loadingIndicator = document.getElementById("loadingIndicator");

    loadingIndicator.style.display = "block";

    const asset = document.createElement("a-asset-item");
    asset.setAttribute("id", "base");
    asset.setAttribute("src", "{{ url_for('static', filename='assets/Plan_B_3D_Scan.glb') }}");

    document.getElementById("assets").appendChild(asset);

    const modelEntity = document.createElement("a-entity");
    modelEntity.setAttribute("id", "modelEntity");
    modelEntity.setAttribute("gltf-model", "#base");
    modelEntity.setAttribute("position", "0.8 0 1.1");
    modelEntity.setAttribute("scale", "1 1 1");

    document.getElementById("scene").appendChild(modelEntity);

    modelEntity.addEventListener("model-loaded", () => {
        console.log("Model fully loaded");
        overlay.classList.add("hidden");
    });

  
  });
  document.addEventListener("DOMContentLoaded", () => {
    const lookControls = document.querySelector("[look-controls]");

    if (lookControls) {
        lookControls.removeEventListener("touchstart", lookControls.__proto__.onTouchStart, false);
        
        lookControls.addEventListener("touchstart", function (event) {
            // Allow touch scrolling by NOT calling preventDefault()
            console.log("Touch event detected, but scroll allowed");
        }, { passive: true });
    }
});
</script>

<style>
  html, body {
    overflow: auto !important; 
    touch-action: auto !important; 
}
  .glbcontainer{
      max-width: 1000px; 
      max-height: 1000px;
      margin:auto; 
      display: flex; 
      justify-content: center; 
      align-items: center;
      flex-direction: column;
      padding: 25px;
      position: relative;
  }
  canvas{
      width: 100%!important; 
      height: 100%!important; 
      border: 1px solid #ccc;
  }

  #overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      z-index: 9999;
  }

  #loadModelBtn {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
  }

  #loadingIndicator {
      font-size: 14px;
      color: white;
      margin-top: 10px;
      display: none;
  }

  @keyframes fadeOut {
      to {
          opacity: 0;
          visibility: hidden;
      }
  }

  .hidden {
      animation: fadeOut 1s forwards;
  }
</style>
  <!-- Gallery -->
    {% endblock %}